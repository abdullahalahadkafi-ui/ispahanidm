<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶®‡¶ø‡¶â‡¶ú ‡¶´‡¶ø‡¶° ‡¶ì ‡¶ï‡¶≤‡¶æ‡¶Æ | ‡¶á‡¶∏‡ßç‡¶™‡¶æ‡¶π‡¶æ‡¶®‡¶ø ‡¶¶‡¶æ‡¶ñ‡¶ø‡¶≤ ‡¶Æ‡¶æ‡¶¶‡ßç‡¶∞‡¶æ‡¶∏‡¶æ</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    <style>
        :root { 
            --p-green: #006a4e; 
            --fb-blue: #1877f2; 
            --bg: #f0f2f5; 
            --white: #ffffff;
            --text-gray: #65676b;
            --react-yellow: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Hind Siliguri', sans-serif; background: var(--bg); color: #050505; padding-top: 80px; }

        /* --- NAVIGATION (‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶¨‡¶ú‡¶æ‡ßü ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá) --- */
        nav { background: #fff; height: 70px; position: fixed; width: 100%; top: 0; z-index: 2000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-bottom: 2px solid var(--p-green); display: flex; align-items: center; padding: 0 5%; }
        .logo { font-weight: 800; color: var(--p-green); text-decoration: none; font-size: 22px; }

        .container { max-width: 600px; margin: auto; padding: 10px; }
        
        /* --- POST CARD --- */
        .post-card { background: var(--white); border-radius: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); margin-bottom: 15px; overflow: hidden; }
        
        .post-header { padding: 12px 16px; display: flex; align-items: center; gap: 10px; }
        .post-header img { width: 42px; height: 42px; border-radius: 50%; object-fit: cover; border: 1px solid #ddd; }
        .header-info b { font-size: 15px; display: block; line-height: 1.2; }
        .header-info span { color: var(--text-gray); font-size: 12px; display: flex; align-items: center; gap: 5px; margin-top: 2px; }

        .post-text { padding: 4px 16px 16px; font-size: 16px; white-space: pre-wrap; }
        .post-img { width: 100%; display: block; max-height: 500px; object-fit: cover; border-top: 1px solid #f0f2f5; border-bottom: 1px solid #f0f2f5; }

        /* --- REACTIONS & STATS --- */
        .post-stats { padding: 10px 16px; display: flex; justify-content: space-between; border-bottom: 1px solid #ebedf0; font-size: 13px; color: var(--text-gray); }
        .react-icons-row { display: flex; align-items: center; gap: -5px; }
        .react-icons-row i { font-size: 16px; }

        .interaction-btns { display: flex; padding: 4px; position: relative; }
        .btn-action { flex: 1; padding: 10px; text-align: center; cursor: pointer; color: var(--text-gray); font-weight: 600; border-radius: 4px; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; transition: 0.2s; }
        .btn-action:hover { background: #f2f2f2; }
        .btn-action.active-react { color: var(--fb-blue); }

        /* Floating Reaction Bar (FB Style) */
        .reaction-container { position: relative; flex: 1; }
        .reaction-bar {
            position: absolute; bottom: 45px; left: 0; background: white;
            padding: 8px 12px; border-radius: 40px; display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); gap: 12px; z-index: 100;
            border: 1px solid #eee;
        }
        .reaction-container:hover .reaction-bar { display: flex; animation: bounceIn 0.3s; }
        .reaction-bar span { font-size: 26px; transition: 0.2s; cursor: pointer; }
        .reaction-bar span:hover { transform: scale(1.4); }

        /* --- COMMENTS AREA --- */
        .comment-area { padding: 10px 16px; background: #fff; display: none; border-top: 1px solid #eee; }
        .comment-area.active { display: block; }
        
        .comment-item { display: flex; gap: 8px; margin-bottom: 10px; }
        .comment-item img { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; }
        .comment-bubble { background: #f0f2f5; padding: 8px 12px; border-radius: 18px; font-size: 13px; max-width: 85%; }
        .comment-bubble b { font-size: 12px; display: block; color: #050505; }

        /* Comment Input */
        .cmt-input-wrapper { display: flex; gap: 8px; align-items: center; position: relative; margin-top: 10px; }
        .cmt-input-wrapper input { flex: 1; padding: 10px 45px 10px 15px; border-radius: 20px; border: none; background: #f0f2f5; outline: none; font-family: inherit; font-size: 14px; }
        .btn-send-cmt { position: absolute; right: 12px; color: var(--fb-blue); cursor: pointer; border: none; background: none; font-size: 18px; }

        @keyframes bounceIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        
        /* Floating AI Icon */
        .ai-btn { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background: var(--p-green); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 1000; text-decoration: none; }
    </style>
</head>
<body>

    <nav>
        <a href="index.html" class="logo">‡¶á‡¶∏‡ßç‡¶™‡¶æ‡¶π‡¶æ‡¶®‡¶ø ‡¶¶‡¶æ‡¶ñ‡¶ø‡¶≤ <span>‡¶Æ‡¶æ‡¶¶‡ßç‡¶∞‡¶æ‡¶∏‡¶æ</span></a>
    </nav>

    <div class="container" id="feed">
        <p style="text-align:center; color:#888; padding:50px;">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <a href="ai-chat.html" class="ai-btn animate__animated animate__pulse animate__infinite"><i class="fas fa-robot"></i></a>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, query, orderBy, onSnapshot, doc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCTxt82Z4KRW425eYAU-WkVJbmUu1Vcy58",
            authDomain: "ispahani-madrasah-portal.firebaseapp.com",
            projectId: "ispahani-madrasah-portal",
            storageBucket: "ispahani-madrasah-portal.firebasestorage.app",
            messagingSenderId: "501627545319",
            appId: "1:501627545319:web:42409b2d8f614dfc3c6442"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;

        // ‡ßß. ‡¶≤‡¶ó‡¶á‡¶® ‡¶ö‡ßá‡¶ï
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            loadFeed();
        });

        // ‡ß®. ‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞
        function formatTime(timestamp) {
            if(!timestamp) return "Just now";
            const seconds = Math.floor((new Date() - timestamp.toDate()) / 1000);
            if (seconds < 60) return seconds + "s";
            if (seconds < 3600) return Math.floor(seconds/60) + "m";
            if (seconds < 86400) return Math.floor(seconds/3600) + "h";
            if (seconds < 2592000) return Math.floor(seconds/86400) + "d";
            return timestamp.toDate().toLocaleDateString('bn-BD');
        }

        // ‡ß©. ‡¶´‡¶ø‡¶° ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
        function loadFeed() {
            const q = query(collection(db, "posts"), orderBy("time", "desc"));
            onSnapshot(q, (snapshot) => {
                const feed = document.getElementById('feed');
                feed.innerHTML = "";
                
                snapshot.forEach((postDoc) => {
                    const post = postDoc.data();
                    const pid = postDoc.id;
                    const imgTag = post.imageUrl ? `<img src="${post.imageUrl}" class="post-img">` : "";
                    
                    // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶∞‡¶ø‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶ö‡ßá‡¶ï
                    let myReact = post.reacts && post.reacts[currentUser?.uid] ? post.reacts[currentUser.uid] : null;

                    feed.innerHTML += `
                        <div class="post-card">
                            <div class="post-header">
                                <img src="${post.authorPhoto || 'https://via.placeholder.com/42'}">
                                <div class="header-info">
                                    <b>${post.author}</b>
                                    <span>${formatTime(post.time)} ‚Ä¢ <i class="fas fa-globe-americas"></i></span>
                                </div>
                            </div>
                            <div class="post-text">${post.text}</div>
                            ${imgTag}
                            
                            <div class="post-stats">
                                <div class="react-icons-row">
                                    <span style="margin-right:5px;">‚ù§Ô∏èüëç ${Object.keys(post.reacts || {}).length}</span>
                                </div>
                                <span onclick="toggleCmt('${pid}')" style="cursor:pointer">${post.comments ? post.comments.length : 0}‡¶ü‡¶ø ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü</span>
                            </div>

                            <div class="interaction-btns">
                                <div class="reaction-container">
                                    <div class="btn-action ${myReact ? 'active-react' : ''}">
                                        <i class="${myReact ? 'fas' : 'far'} fa-thumbs-up"></i> 
                                        ${myReact ? myReact : '‡¶≤‡¶æ‡¶á‡¶ï'}
                                    </div>
                                    <div class="reaction-bar">
                                        <span onclick="sendReact('${pid}', 'üëç')">üëç</span>
                                        <span onclick="sendReact('${pid}', '‚ù§Ô∏è')">‚ù§Ô∏è</span>
                                        <span onclick="sendReact('${pid}', 'ü•∞')">ü•∞</span>
                                        <span onclick="sendReact('${pid}', 'üòÇ')">üòÇ</span>
                                        <span onclick="sendReact('${pid}', 'üòÆ')">üòÆ</span>
                                        <span onclick="sendReact('${pid}', 'üò°')">üò°</span>
                                    </div>
                                </div>
                                <div class="btn-action" onclick="toggleCmt('${pid}')">
                                    <i class="far fa-comment"></i> ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü
                                </div>
                                <div class="btn-action" onclick="share('${pid}')">
                                    <i class="far fa-share-square"></i> ‡¶∂‡ßá‡ßü‡¶æ‡¶∞
                                </div>
                            </div>

                            <div class="comment-area" id="area-${pid}">
                                <div class="comment-list">
                                    ${(post.comments || []).map(c => `
                                        <div class="comment-item">
                                            <img src="https://via.placeholder.com/32">
                                            <div class="comment-bubble"><b>${c.user}</b>${c.text}</div>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="cmt-input-wrapper">
                                    <input type="text" id="in-${pid}" placeholder="‡¶è‡¶ï‡¶ü‡¶ø ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." onkeypress="if(event.key==='Enter') sendCmt('${pid}')">
                                    <button class="btn-send-cmt" onclick="sendCmt('${pid}')"><i class="fas fa-paper-plane"></i></button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            });
        }

        // ‡ß™. ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶∏‡¶Æ‡ßÇ‡¶π
        window.sendReact = async (pid, emoji) => {
            if(!currentUser) return alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶ó‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®!");
            const ref = doc(db, "posts", pid);
            const updates = {};
            updates[`reacts.${currentUser.uid}`] = emoji;
            await updateDoc(ref, updates);
        };

        window.sendCmt = async (pid) => {
            const input = document.getElementById(`in-${pid}`);
            if(!input.value || !currentUser) return alert("‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®!");
            const ref = doc(db, "posts", pid);
            await updateDoc(ref, {
                comments: arrayUnion({
                    user: currentUser.displayName,
                    text: input.value,
                    time: new Date()
                })
            });
            input.value = "";
        };

        window.toggleCmt = (id) => document.getElementById(`area-${id}`).classList.toggle('active');

        window.share = (id) => {
            const link = window.location.href.split('?')[0] + "?post=" + id;
            navigator.clipboard.writeText(link);
            alert("‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§");
        };

    </script>
</body>
</html>